## 连线功能

- 计算出 item 中心位置,计算出删 svg 的起始位置和 line 的结束位置
  - 因为子项目可以移动,所以 svg 的起始位置可能不是父节点中心而是子节点中心
- 

## 编辑 title 功能

- contenteditable: false 的元素, 双击自动改成 true,并自动获取焦点(focus()无效 )
  1. 因为 false 改成 true 后,要 nextTick 可以再获取焦点
- tab 在浏览器的默认事件

## 拖拽item

- 不跟手
  - 因为注册了 item.onmouseleave 事件, 导致鼠标离开 item 时会 isMoving=false,停止移动
  - 删掉这一事件, 快速拖动过程不跟手,但是最终位置是不变的

## 画布

### 拖动画布

- `window.scrollTo(window.scrollX - event.movementX / scale, window.scrollY - event.movementY/scale);`
  - 缩小时拖动,移动同样鼠标距离滚动条移动px要更多
- 

### 缩放

- 保证中心位置缩放后还在中心
  - 用scale控制designer缩放，里面所有内容都会缩放。他们的实际大小不会变比如width，margin，left。 但是会影响getBoundingClient().x
  - 把designer 的 transform-origin: 0 0;
  - 放大后原始中心位置会向右下角偏移， 再用window.scrollTo() 来把视口向右下角移动。这样就能保证中心位置缩放后还在中心。

> 遇到的问题：
>
> fixed定位的元素，如果其父元素带transform则不会再相对于视口，而是相对于其父元素
>

### 框选

因为框选会受到scale莫名其妙的影响,选择起点就会很难,所以我想绕过scale的影响

1. 获取起点相对于文档的坐标`e.pageX`,也就是相对于designer的坐标,但是文档是没有scale效果的
2. 通过`left = e.pageX / scaleRatio` 得到了其应该在desginer元素上的绝对定位坐标


### 背景

- 整体太大,不能直接创建
  - 只创建视口部分, 放大缩小根据缩放比例调整网格密度,依然消耗性能
- 利用 background-img 重复填充的特性

```html
<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50">
  <path d="M25 0 v50" stroke="black" stroke-opacity="0.1" stroke-dasharray="16,4" />
  <path d="M0 25 h50" stroke="black" stroke-opacity="0.1" stroke-dasharray="16,4" />
</svg>
```

## 滚动恢复

* window.scrollTo失效
  * 当我打开一个页面然后手动滚动到其他地方后，再刷新页面，此时页面会闪到scrollTo的位置，然后立刻闪回我上次手动滚动到的位置。

```js
if ('scrollRestoration' in history) {
    history.scrollRestoration = 'manual';
} 
```

> history 也是浏览器全局属性

## 右键菜单-指令

* *为什么createApp时传入ref props 不会自动解包？？？*
* 全局指令必须在app.mount之前注册！
* 具有复用性

## 感受

### 1. 前期打好架构真的很重要

比如吃亏在比如缩放功能，

前期直接利用ctrl+滚轮来缩放，还有再控制一下缩放中心始终以画面中心

然后因为 发现所有东西都被缩放了，所以又改用scale 来缩放designer

最后觉得早知道整个designer可以用svg来做，利用viewbox 来实现缩放
